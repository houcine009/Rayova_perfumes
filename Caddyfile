# Frontend - Main domain with automatic HTTPS
rayovaparfums.com, www.rayovaparfums.com {
    root * /var/www/frontend
    file_server
    
    # Handle React Router (SPA)
    try_files {path} /index.html
    
    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
    }
    
    # Compression (zstd is generally better/faster than gzip)
    encode zstd gzip

    # Browser Caching
    # Aggressive caching for fingerprinted assets (JS, CSS)
    @static_hashed {
        path_regexp \.(js|css|woff2|png|jpg|jpeg|gif|svg|ico|webp)$
    }
    header @static_hashed {
        Cache-Control "public, max-age=31536000, immutable"
    }

    # Moderate caching for other assets (videos, etc.)
    @static_media {
        path_regexp \.(mp4|webm|mov|ogg)$
    }
    header @static_media {
        Cache-Control "public, max-age=86400, must-revalidate"
    }
}

# Backend API - Subdomain with automatic HTTPS
api.rayovaparfums.com {
    reverse_proxy backend:80
    
    # CORS headers
    header {
        Access-Control-Allow-Origin https://rayovaparfums.com
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization, Accept"
        Access-Control-Allow-Credentials true
    }
    
    # Handle preflight requests
    @options method OPTIONS
    respond @options 204
}
